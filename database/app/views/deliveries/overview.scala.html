@(collections: Seq[models.deliveries.ChunkedDeliveryVersion])(implicit flash: play.api.mvc.Flash)

@title = {
    Deliveries
}

@main(title, nav = "deliveries") {
<div id="accordion2" class="accordion">
    @flash.get("delete").map { message =>
        <div class="alert alert-error">
            @message
        </div>
    }
    @flash.get("activate").map { message =>
        <div class="alert alert-success">
            @message
        </div>
    }
    @collections.map {
        case (delivery) => {
            <div class="accordion-group">
                <div class="accordion-heading">
                    <div class="accordion-toggle">
                        <div class="row">
                            <span class="span8">
                            <a href="#@delivery.collapseId" data-parent="#accordion2" data-toggle="collapse">
                                <strong>@delivery.chunkKey - @delivery.version</strong>
                            </a>
                            </span>
                            @if(delivery.allRunning) {
                                <span class="label label-success offset2">All running </span>
                            }
                            @if(delivery.someRunning) {
                                <span class="label label-warning offset2">Some running </span>
                            }
                            @if(delivery.noneRunning) {
                                <span class="label offset2">None running </span>
                            }
                        </div>
                        <div style="font-size: smaller;">@delivery.info</div>
                        <div style="font-size: smaller;">@delivery.date - @delivery.formatedCompressedSize compressed data - @delivery.formatedUncompressedSize uncompressed data - @delivery.formatedIndexSize index</div>
                    </div>
                </div>
                <div class="accordion-body collapse" id="@delivery.collapseId" style="height: 0px;">
                    <div class="accordion-inner">
                        <div>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Collection</th>
                                        <th>Compressed</th>
                                        <th>Uncompressed</th>
                                        <th>Index</th>
                                        <th>&nbsp;</th>
                                        <th>&nbsp;</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @delivery.collections.map {
                                    case (collection) => {
                                    <tr>
                                        <td>@collection.collectionName</td>
                                        <td>@collection.formatedCompressedSize</td>
                                        <td>@collection.formatedUncompressedSize</td>
                                        <td>@collection.formatedIndexSize</td>
                                        <td>
                                             @if(collection.active) {
                                                 <span class="label label-success">Running</span>
                                             } else {
                                                 <a class="btn btn-inverse" href="@routes.Deliveries.activateChunkedVersionInCollection(collection.collectionName, delivery.chunkKey, delivery.version)" onclick="return confirm('Are you sure?');"><i class="icon-hand-right icon-white"></i> Activate</a>

                                             }
                                        </td>
                                        <td><a class="btn btn-danger" href="@routes.Deliveries.deleteChunkedVersionInCollection(collection.collectionName, delivery.chunkKey, delivery.version)" onclick="return confirm('Are you sure?');"><i class="icon-trash icon-white"></i></a></td>

                                    </tr>
                                    }}
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td><strong>@delivery.formatedCompressedSize</strong></td>
                                        <td><strong>@delivery.formatedUncompressedSize</strong></td>
                                        <td><strong>@delivery.formatedIndexSize</strong></td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                    </tr>
                                </tbody>
                            </table>
                            <a class="btn btn-inverse" href="@routes.Deliveries.activateChunkedVersionForAllCollections(delivery.chunkKey, delivery.version)" onclick="return confirm('Are you sure?');"><i class="icon-hand-right icon-white"></i> Activate delivery version</a>
                            &nbsp;&nbsp;
                            <a class="btn btn-danger" href="@routes.Deliveries.deleteChunkedVersionForAllCollections(delivery.chunkKey, delivery.version)" onclick="return confirm('Are you sure?');"><i class="icon-trash icon-white"></i> Delete delivery version</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    }

</div>
}